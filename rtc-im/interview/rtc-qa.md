# RTC 面试问答

实时音视频通信（Real-Time Communication）相关面试题和答案。

## 目录

- [基础概念](#基础概念)
- [WebRTC](#webrtc)
- [编解码](#编解码)
- [网络传输](#网络传输)
- [性能优化](#性能优化)
- [系统设计](#系统设计)

---

## 基础概念

### Q1: RTC 和 IM 的区别是什么？

**答案：**

| 特性 | RTC (实时音视频) | IM (即时通讯) |
|------|-----------------|--------------|
| **主要功能** | 实时音视频通话 | 文本消息传递 |
| **延迟要求** | 极低（< 200ms） | 较低（< 1s） |
| **协议** | RTP/RTCP, WebRTC | WebSocket, TCP |
| **数据量** | 大（音视频流） | 小（文本、图片） |
| **可靠性** | 可容忍丢包 | 必须可靠 |
| **典型应用** | 视频会议、直播 | 聊天、通知 |

### Q2: 实时通信面临的主要技术挑战有哪些？

**答案：**

1. **延迟（Latency）**
   - 网络延迟
   - 处理延迟（编码、解码）
   - 缓冲延迟

2. **丢包（Packet Loss）**
   - 网络拥塞
   - 网络抖动
   - 需要重传或错误恢复

3. **带宽（Bandwidth）**
   - 动态带宽变化
   - 带宽自适应
   - 码率控制

4. **设备差异**
   - 不同设备的性能
   - 不同网络环境
   - 兼容性问题

5. **同步问题**
   - 音视频同步
   - 多端同步
   - 状态同步

### Q3: QoS 和 QoE 的区别？

**答案：**

- **QoS (Quality of Service)**：服务质量，客观指标
  - 延迟、丢包率、带宽、抖动
  - 可测量的网络指标

- **QoE (Quality of Experience)**：体验质量，主观感受
  - 用户对服务的整体感受
  - 受 QoS 影响，但不完全等同

---

## WebRTC

### Q4: WebRTC 的工作原理是什么？

**答案：**

WebRTC 的核心流程：

1. **信令交换（Signaling）**
   - 交换 SDP（Session Description Protocol）
   - 交换 ICE 候选（ICE Candidates）
   - 建立连接

2. **ICE 候选收集**
   - 收集本地 IP 地址
   - 通过 STUN 获取公网 IP
   - 通过 TURN 获取中继地址

3. **连接建立**
   - ICE 连接检查
   - DTLS 握手（加密）
   - SRTP 建立（媒体加密）

4. **媒体传输**
   - 音频/视频采集
   - 编码
   - RTP 传输
   - 解码
   - 播放

### Q5: SDP 是什么？包含哪些信息？

**答案：**

SDP (Session Description Protocol) 用于描述媒体会话。

**包含信息：**
- 会话信息（会话 ID、时间）
- 媒体类型（音频/视频）
- 媒体格式（编码格式、采样率）
- 网络信息（IP、端口）
- 传输协议（RTP/RTCP）

**示例：**
```
v=0
o=- 123456 2 IN IP4 127.0.0.1
s=-
t=0 0
m=audio 9 UDP/TLS/RTP/SAVPF 111
a=rtpmap:111 opus/48000/2
m=video 9 UDP/TLS/RTP/SAVPF 96
a=rtpmap:96 VP8/90000
```

### Q6: ICE 是什么？STUN 和 TURN 的作用？

**答案：**

**ICE (Interactive Connectivity Establishment)**：用于建立 P2P 连接。

**STUN (Session Traversal Utilities for NAT)**：
- 获取公网 IP 和端口
- 检测 NAT 类型
- 免费，但只能处理简单 NAT

**TURN (Traversal Using Relays around NAT)**：
- 中继服务器
- 处理复杂 NAT 场景
- 需要服务器资源，有成本

**选择策略：**
1. 先尝试直连（Host）
2. 再尝试 STUN（Server Reflexive）
3. 最后使用 TURN（Relay）

### Q7: WebRTC 的延迟来源有哪些？如何优化？

**答案：**

**延迟来源：**
1. 采集延迟（摄像头/麦克风）
2. 编码延迟（10-50ms）
3. 网络延迟（RTT）
4. 解码延迟（10-50ms）
5. 播放缓冲（50-200ms）

**优化方法：**
1. **降低编码延迟**
   - 使用低延迟编码器
   - 减少 GOP 大小
   - 降低分辨率/帧率

2. **网络优化**
   - 使用 UDP（WebRTC 默认）
   - 就近部署服务器
   - CDN 加速

3. **减少缓冲**
   - 降低播放缓冲
   - 自适应缓冲策略

4. **硬件加速**
   - 使用硬件编码/解码
   - GPU 加速

---

## 编解码

### Q8: 常见的音视频编解码格式有哪些？

**答案：**

**音频编解码：**
- **Opus**：WebRTC 默认，低延迟，高质量
- **AAC**：广泛使用，高质量
- **G.711**：传统电话，低质量
- **G.722**：宽带音频

**视频编解码：**
- **VP8/VP9**：Google，开源，WebRTC 常用
- **H.264**：广泛支持，硬件加速好
- **H.265 (HEVC)**：高压缩比，专利问题
- **AV1**：新一代，开源，压缩比高

### Q9: 如何选择编解码器？

**答案：**

**考虑因素：**
1. **延迟要求**
   - 低延迟：Opus + VP8/VP9
   - 可接受延迟：AAC + H.264

2. **带宽限制**
   - 低带宽：低码率编码器
   - 高带宽：高质量编码器

3. **设备支持**
   - 硬件加速：H.264
   - 软件解码：VP8/VP9

4. **专利问题**
   - 开源：VP8/VP9, AV1
   - 商业：H.264, H.265

---

## 网络传输

### Q10: RTP 和 RTCP 的作用？

**答案：**

**RTP (Real-time Transport Protocol)**：
- 传输音视频数据
- 提供时间戳、序列号
- 不保证可靠性（UDP）

**RTCP (RTP Control Protocol)**：
- 传输控制信息
- 质量反馈（丢包率、延迟）
- 用于自适应调整

### Q11: 网络自适应是如何工作的？

**答案：**

**自适应机制：**
1. **带宽估计**
   - 通过 RTCP 反馈
   - 通过延迟变化
   - 通过丢包率

2. **码率调整**
   - 带宽充足：提高码率
   - 带宽不足：降低码率

3. **分辨率/帧率调整**
   - 网络差：降低分辨率
   - 网络好：提高分辨率

4. **编码参数调整**
   - GOP 大小
   - 关键帧间隔

---

## 性能优化

### Q12: 如何优化 RTC 的延迟？

**答案：**

1. **编码优化**
   - 使用低延迟编码器
   - 减少 GOP 大小
   - 降低编码复杂度

2. **网络优化**
   - 使用 UDP
   - 就近部署服务器
   - 优化路由

3. **缓冲优化**
   - 减少播放缓冲
   - 自适应缓冲

4. **处理优化**
   - 硬件加速
   - 多线程处理
   - 减少内存拷贝

### Q13: 如何处理网络抖动和丢包？

**答案：**

**网络抖动：**
- 使用抖动缓冲（Jitter Buffer）
- 自适应缓冲大小
- 平滑播放

**丢包处理：**
1. **前向纠错（FEC）**
   - 发送冗余数据
   - 可以恢复部分丢包

2. **重传（Retransmission）**
   - 关键帧重传
   - 选择性重传

3. **错误隐藏（Error Concealment）**
   - 使用前一帧
   - 插值恢复

4. **自适应码率**
   - 降低码率减少丢包
   - 提高可靠性

---

## 系统设计

### Q14: 设计一个视频会议系统需要考虑哪些方面？

**答案：**

**架构设计：**
1. **客户端**
   - 音视频采集
   - 编码/解码
   - 网络传输
   - UI 交互

2. **信令服务器**
   - 房间管理
   - 用户管理
   - SDP 交换
   - 状态同步

3. **媒体服务器（可选）**
   - SFU (Selective Forwarding Unit)
   - MCU (Multipoint Control Unit)
   - 录制/转码

4. **基础设施**
   - STUN/TURN 服务器
   - 监控系统
   - 日志系统

**关键技术：**
- WebRTC
- 信令协议（WebSocket）
- 媒体服务器（Janus, Kurento）
- 负载均衡
- 容错机制

### Q15: SFU 和 MCU 的区别？

**答案：**

**SFU (Selective Forwarding Unit)**：
- 选择性转发
- 每个客户端独立编码
- 服务器只转发，不处理
- 低延迟，高扩展性
- 适合大规模会议

**MCU (Multipoint Control Unit)**：
- 多点控制
- 服务器混流
- 客户端只接收一个流
- 高服务器负载
- 适合小规模会议

**选择建议：**
- 大规模：SFU
- 小规模：MCU
- 混合：根据场景选择

---

## 扩展问题

### Q16: WebRTC 的安全性如何保证？

**答案：**

1. **DTLS**：加密信令
2. **SRTP**：加密媒体流
3. **身份验证**：防止未授权访问
4. **权限控制**：房间权限管理

### Q17: 如何处理不同网络环境（WiFi、4G、5G）？

**答案：**

1. **网络检测**
   - 检测网络类型
   - 检测带宽
   - 检测延迟

2. **自适应策略**
   - WiFi：高质量
   - 4G：中等质量
   - 5G：高质量

3. **降级策略**
   - 网络差时降低质量
   - 网络好时提高质量

---

## 参考资料

- [WebRTC 官方文档](https://webrtc.org/)
- [RFC 文档](https://www.rfc-editor.org/)
- [WebRTC 最佳实践](https://webrtc.org/getting-started/overview)

