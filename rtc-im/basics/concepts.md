# RTC & IM 核心概念

实时通信和即时通讯的核心概念和基础知识。

## 目录

- [RTC vs IM](#rtc-vs-im)
- [技术挑战](#技术挑战)
- [关键指标](#关键指标)
- [架构模式](#架构模式)

---

## RTC vs IM

### 定义

**RTC (Real-Time Communication) - 实时通信**
- 实时音视频通话
- 低延迟要求（< 200ms）
- 大带宽需求
- 可容忍丢包

**IM (Instant Messaging) - 即时通讯**
- 文本消息传递
- 延迟要求较低（< 1s）
- 小带宽需求
- 必须可靠

### 对比表

| 特性 | RTC | IM |
|------|-----|-----|
| **主要功能** | 音视频通话 | 消息传递 |
| **延迟要求** | < 200ms | < 1s |
| **协议** | RTP/RTCP, WebRTC | WebSocket, TCP |
| **数据量** | 大（MB/s） | 小（KB） |
| **可靠性** | 可容忍丢包 | 必须可靠 |
| **典型应用** | 视频会议、直播 | 聊天、通知 |

---

## 技术挑战

### 1. 延迟（Latency）

**延迟来源：**
- 网络延迟（RTT）
- 处理延迟（编码、解码）
- 缓冲延迟
- 系统延迟

**优化方法：**
- 使用 UDP
- 降低编码延迟
- 减少缓冲
- 就近部署

### 2. 丢包（Packet Loss）

**原因：**
- 网络拥塞
- 网络抖动
- 链路质量差

**处理方法：**
- 前向纠错（FEC）
- 重传机制
- 错误隐藏
- 自适应码率

### 3. 带宽（Bandwidth）

**挑战：**
- 动态带宽变化
- 带宽限制
- 成本控制

**解决方案：**
- 带宽自适应
- 码率控制
- 多码率转码
- CDN 加速

### 4. 同步（Synchronization）

**同步类型：**
- 音视频同步
- 多端同步
- 状态同步

**实现方法：**
- 时间戳
- 序列号
- 心跳机制

---

## 关键指标

### QoS (Quality of Service)

**网络指标：**
- **延迟（Latency）**：数据包传输时间
- **丢包率（Packet Loss）**：丢失数据包比例
- **带宽（Bandwidth）**：数据传输速率
- **抖动（Jitter）**：延迟变化

### QoE (Quality of Experience)

**用户体验指标：**
- **MOS (Mean Opinion Score)**：主观评分
- **视频质量**：分辨率、帧率
- **音频质量**：清晰度、连续性
- **交互体验**：响应速度

### 性能指标

**系统指标：**
- **QPS**：每秒请求数
- **并发数**：同时在线用户
- **吞吐量**：消息/秒
- **可用性**：99.9%, 99.99%

---

## 架构模式

### 1. 客户端-服务器（C/S）

**特点：**
- 集中式架构
- 服务器处理所有逻辑
- 客户端简单

**适用场景：**
- IM 系统
- 简单 RTC 应用

### 2. P2P（Peer-to-Peer）

**特点：**
- 点对点通信
- 服务器只做信令
- 减少服务器压力

**适用场景：**
- 小规模 RTC
- 文件传输

### 3. 混合架构

**特点：**
- 结合 C/S 和 P2P
- 根据场景选择
- 灵活性强

**适用场景：**
- 大规模系统
- 复杂业务场景

---

## 协议栈

### RTC 协议栈

```
应用层: 应用逻辑
  ↓
信令层: WebSocket, SIP
  ↓
媒体层: RTP/RTCP
  ↓
传输层: UDP
  ↓
网络层: IP
```

### IM 协议栈

```
应用层: 消息协议
  ↓
传输层: WebSocket, TCP
  ↓
网络层: IP
```

---

## 关键技术

### 1. 编解码

**音频编解码：**
- Opus（WebRTC 默认）
- AAC
- G.711

**视频编解码：**
- VP8/VP9
- H.264
- H.265
- AV1

### 2. 网络传输

**协议：**
- RTP/RTCP（媒体）
- WebSocket（信令）
- UDP（实时）
- TCP（可靠）

### 3. 信令

**功能：**
- 建立连接
- 交换媒体信息
- 协商参数

**协议：**
- WebSocket
- SIP
- 自定义协议

---

## 参考资料

- [WebRTC 官方文档](https://webrtc.org/)
- [RFC 文档](https://www.rfc-editor.org/)
- [实时通信技术](https://en.wikipedia.org/wiki/Real-time_communication)

