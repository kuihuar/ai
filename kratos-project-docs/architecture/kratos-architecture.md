# Kratos 架构实践

## 概述

Kratos 是 Go 语言的一个微服务框架，采用分层架构设计，强调清晰的分层和依赖注入。

## 核心架构

### 分层结构

```
┌─────────────────┐
│   API Layer     │  (api/) - 定义接口协议
├─────────────────┤
│  Service Layer  │  (internal/service/) - 业务服务实现
├─────────────────┤
│   Biz Layer     │  (internal/biz/) - 业务逻辑
├─────────────────┤
│   Data Layer    │  (internal/data/) - 数据访问
└─────────────────┘
```

### 各层职责

#### API Layer (api/)
- **职责**：定义服务接口协议
- **内容**：Protobuf 文件定义
- **原则**：
  - 接口定义与实现分离
  - 版本化管理（v1, v2...）
  - 清晰的错误定义

#### Service Layer (internal/service/)
- **职责**：实现 API 定义的接口
- **特点**：
  - 薄层，主要负责参数校验和调用 Biz 层
  - 处理 HTTP/gRPC 协议转换
  - 不包含业务逻辑

#### Biz Layer (internal/biz/)
- **职责**：核心业务逻辑
- **特点**：
  - 业务领域模型
  - 业务规则和流程
  - 不依赖具体的数据存储实现

#### Data Layer (internal/data/)
- **职责**：数据访问和持久化
- **特点**：
  - 数据库操作
  - 外部服务调用
  - 缓存管理

## 依赖方向

```
API → Service → Biz → Data
```

**关键原则**：依赖只能从上层指向下层，不能反向依赖。

## 依赖注入

使用 Wire 进行依赖注入，实现：
- 解耦组件依赖
- 便于测试
- 清晰的依赖关系

## 最佳实践

1. **保持分层清晰**：每层只关注自己的职责
2. **接口抽象**：Biz 层定义接口，Data 层实现
3. **错误传播**：使用统一的错误处理机制
4. **配置管理**：集中管理配置，支持多环境

