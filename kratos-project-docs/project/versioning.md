# 版本管理

## 语义化版本

遵循 [Semantic Versioning](https://semver.org/) 规范：

```
MAJOR.MINOR.PATCH
```

- **MAJOR**：不兼容的 API 变更
- **MINOR**：向后兼容的功能新增
- **PATCH**：向后兼容的问题修复

### 示例
- `v1.0.0`：初始版本
- `v1.1.0`：新增功能
- `v1.1.1`：修复 bug
- `v2.0.0`：重大变更，不兼容

## API 版本管理

### URL 版本控制
```
/api/v1/users
/api/v2/users
```

### Protobuf 版本控制
```
api/
├── helloworld/
│   ├── v1/
│   │   └── greeter.proto
│   └── v2/
│       └── greeter.proto
```

## Git 版本管理

### 分支策略
- `main`：主分支，稳定版本
- `develop`：开发分支
- `release/v1.0.0`：发布分支
- `hotfix/v1.0.1`：热修复分支

### 标签管理
```bash
# 创建标签
git tag -a v1.0.0 -m "Release version 1.0.0"

# 推送标签
git push origin v1.0.0
```

## 版本发布流程

### 1. 准备发布
- 更新版本号
- 更新 CHANGELOG
- 完成测试

### 2. 创建发布分支
```bash
git checkout -b release/v1.0.0
```

### 3. 发布
- 创建 Git 标签
- 构建发布包
- 部署到生产环境

### 4. 维护
- 修复 bug 创建 hotfix 分支
- 合并到 main 和 develop

## CHANGELOG

维护变更日志，记录每个版本的变更：

```markdown
# Changelog

## [1.1.0] - 2024-01-15

### Added
- 新增用户查询接口
- 支持用户头像上传

### Changed
- 优化用户创建接口性能

### Fixed
- 修复用户删除时的数据一致性问题

## [1.0.0] - 2024-01-01

### Added
- 初始版本发布
- 用户 CRUD 接口
```

## 向后兼容

### 保持兼容的原则
1. **添加字段**：新字段使用可选类型
2. **不删除字段**：标记为废弃，但不删除
3. **不改变类型**：保持字段类型不变
4. **扩展枚举**：可以添加新的枚举值

### 不兼容变更
当需要进行不兼容变更时：
1. 创建新版本 API（如 v2）
2. 保持旧版本 API 继续运行
3. 提供迁移指南
4. 设置废弃时间表

## 最佳实践

1. **明确版本策略**：制定清晰的版本管理策略
2. **自动化版本**：使用工具自动管理版本号
3. **文档同步**：版本变更时更新文档
4. **沟通透明**：及时通知版本变更和废弃计划

