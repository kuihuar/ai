### 理解
1. select和poll更通用， epoll只适用linux
2. select有文件描述符数量限制
3. poll使用链表，没有数量限制
4. epoll使用事件驱动，避免线性扫描

---

### SELECT
##### 工作机制
- 文件描述符集合：使用 fd_set 位图结构（固定大小，如 1024）保存监控的文件描述符。

- 触发模式：水平触发（LT，Level-Triggered）。

- 流程：

    1. 用户将需要监控的 fd 添加到 readfds/writefds/exceptfds 集合。

    2. 调用 select() 阻塞等待，内核轮询检查所有 fd。

    3. 返回后，用户需遍历所有 fd 找出就绪的。

##### 缺点
- 文件描述符数量限制：默认最大 1024（可调整但效率下降）。

- 重复传递集合：每次调用需重新设置监控的 fd 集合。

- 线性扫描开销：每次需遍历所有 fd，时间复杂度为 O(n)。

- 内存拷贝：用户态到内核态的数据拷贝开销。

##### 适用场景
- 跨平台兼容性要求高（Windows 也支持 select）。

- 监控的 fd 数量较少。

---

### POLL
##### 工作机制
- 文件描述符集合：使用 pollfd 结构数组（动态链表，无数量限制）。

- 触发模式：水平触发（LT）。

- 流程：

    1. 用户将需要监控的 fd 填入 pollfd 数组。

    2. 调用 poll() 阻塞等待，内核轮询检查所有 fd。

    3. 返回后，用户需遍历所有 fd 找出就绪的。

##### 改进点
- 无文件描述符数量限制：基于链表动态管理。

- 支持更精细的事件类型（如 POLLRDHUP）。

##### 缺点
- 线性扫描开销：与 select 类似，时间复杂度 O(n)。

- 内存拷贝：用户态到内核态的数据拷贝。

##### 适用场景
- 需监控的 fd 数量较多，但无法使用 epoll（如非 Linux 系统）。

### EPOLL
##### 工作机制
- 文件描述符集合：通过 epoll_create 创建内核事件表（红黑树 + 就绪链表）。

- 触发模式：支持水平触发（LT）和边缘触发（ET，Edge-Triggered）。

- 流程：

    1. 调用 epoll_create 创建事件表。

    2. 调用 epoll_ctl 向表中添加/删除/修改需要监控的 fd。

    2. 调用 epoll_wait 阻塞等待就绪事件，内核直接返回就绪的 fd 列表。

##### 核心优势
- 无文件描述符数量限制：基于红黑树动态管理。

- 事件驱动机制：内核通过回调直接通知就绪事件，无需遍历所有 fd，时间复杂度 O(1)。

- 零拷贝：通过内存映射（mmap）共享用户态和内核态的事件表。

高效触发模式：ET 模式减少重复通知。

##### 缺点
- 仅限 Linux 系统：不具备跨平台兼容性。

- 复杂事件处理：ET 模式需用户正确处理未读完的数据。

##### 适用场景
- 高并发、高吞吐量的网络服务（如 Nginx、Redis）。

- 需要支持数万甚至百万级并发连接。

### 对比表格
| 特性 | select | poll | epoll |
| ---- | ---- | ---- | ---- |
| 文件描述符数量 | 有限（默认 1024） | 无限制 | 无限制 |
| 数据结构 | 位图（fd_set） | 数组（pollfd） | 红黑树 + 就绪链表 |
| 触发模式 | 仅水平触发（LT） | 仅水平触发（LT） | 支持 LT 和 ET |
| 时间复杂度 | O(n) 遍历所有 fd | O(n) 遍历所有 fd | O(1) 事件驱动 |
| 内存拷贝 | 每次调用需拷贝 fd 集合到内核 | 同 select | 通过 mmap 共享内存，零拷贝 |
| 跨平台支持 | 广泛支持（Linux/Windows/macOS） | 多数 Unix 系统 | 仅 Linux |
| 适用场景 | 低并发、跨平台需求 | 中低并发、无 epoll 的系统 | 高并发、Linux 系统 |

### 性能总结
1. 低并发场景： select 和 poll 性能相爱，但epoll无明显优势
2. 高并发场景： epoll性能远超select和poll， 尤其是连接数超过1万时
    - select/poll的O(n)遍历导致CPU占用率飙升
    - epoll的O(1)事件驱动机制保持高效

### 选择建议
1. Linux 系统且需高并发：优先使用 epoll。
2. 跨平台或低并发：使用 select 或 poll。
3. 精细事件控制：若需要 ET 模式（如避免重复通知），选择 epoll    