### 亲和性部署策略：
 1. 第一个策略是，当两个服务在多地域有部署时，Client 和 Server不进行跨地域调用
 2. 第二个优化策略是，当两个服务在同地域多机房有部署时，Client 和 Server不进行跨机房调用。
 3. 还可以将两个服务，尽可能地部署到一台物理机上
 ### db
 
 - 首先是读写分离架构。当我们数据库读 QPS 过高时，可以通过读写分离架构，增加从库来提升数据库集群的读 QPS。
 - 其次是分库分表。当我们数据库表的数据量过大时，可以通过分库分表来拆分数据库表，从而降低单表的数据量，提高数据库集群的读 QPS。
     - 当我们单表数据行数太多，导致读性能下降时，可以用分表架构，将一张表拆成多张小表，从而提升读性能。(是指当单表数据量过大，导致查询性能变差时，我们可以将这个大的数据表，按照一定的规则拆分成多个较小的数据表，从而提升表数据查询的性能)
     - 我们数据库写入 TPS 过高时，可以用分库架构，通过增加多个主库，分散单库的写压力，从而提升数据库整体的写 TPS 上限。(是指在单库写操作的 TPS 处于较高水平时，我们能够对数据库进行拆分，构建出多个主库，并且把写请求分散到这些不同的主库之中)
 - 最后是缓存。当我们数据库读 QPS 过高时，可以通过缓存来减少数据库的读 QPS。

#### 三种常分表方案
1. 第一种是范围路由方案。所谓范围路由，是指针对整型、时间戳等数据类型，按照其数值范围进行拆分，使处于不同范围的数据分别存储到不同的子表之中。
2. 第二种是 hash 路由方案。所谓 hash 路由，就是通过计算某个特定列的 hash 值，然后依据该 hash 值将数据路由分配至不同的子表当中。
3. 第三种是配置路由方案。所谓配置路由方案，意味着我们能够进行相关配置，使得数据依据某个列的值来完成路由操作。例如，我们可以在远程配置文件里设定城市路由规则，这样一来，不同城市的用户数据便会被分别存储到不同的子表之中

#### 网上有种说法，MySQL 表行数超过 2000w 左右，一般会被认为是大表，需要做拆分，这个数值是怎么来的呢？
1. Mysql用索引组织数据,索引是B+树;
2. 非叶子节点和叶子节点，都保存在数据页中；
3. 一个数据页大小是16k,理论上mysql的B+树,最多有1280个树杈；计算过程如下：
   a. 非叶子节点的数据页（每个页的大小是16k）,去掉每页的head和tail信息,有15k的空间，用来存放索引指针信息；
   b. 一个索引指针需要12Byte（主键ID:8Byte、指向下游的页号:4Byte）
   c. 15k/12Byte = 1280,也就是B+树最多有1280个树杈
4. 叶子节点存放的真实数据，假如一行数据的大小按1k，一个数据页，可以存15行数据；
5. 设B+树的层树为x,则叶子节点的数量有: 1280 ** (x - 1) *15   [1280的x-1次方,在乘以15]
6. 假如树只有3层（基于IO效率考虑）,则可以存放:1280 ** 2 * 15 = 2.5千万 行数据

注意: 这有有很多限定条件，如至于3层，一行数据按1k计算。
作者回复: 👍👍，所以计算过程是有很多假设的。实践里保险起见，数据量比较大的时候，还是要根据我们的数据和查询方式，提前做好容量压测


#### 分布式事务
