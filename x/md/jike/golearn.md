## 性能优化流程
1. 定目标
2. 找瓶颈点
3. 分析原因
4. 性能优化
5. 验证目标是否达成


### 性能目标
QPS
延时
数据量
比如100Wqps, 平均延时10ms,避免过度优化



分布式缓存，本地缓存
满足整体qps 诉求和延时不上涨的前提下，月机器成本从100W降到10W，单机吞吐从1000qps升到1Wqps

找性能达不到目标的组件
用性能测试的方法找瓶颈，单个请求测试和集群整体压测
单个请求
单个请求测试的目的是看接口延时是否符合预期，如果达不到需要定位下游哪个组件响应时间比较长
整体压测
整体压测是看服务的整体qps是否达到需求，逐步加压，如果目标qps没达成，根据监控定位哪个组件没达到目的qps，但是已经超时


通过单个请求测试和服务整体压测，可以找到限制延时和吞吐达到性能目标的组件，也就是瓶颈点

### 瓶颈分析
1. 如果内部接口计算逻辑导致延时过长或者单机cpu资源消耗过高，可以用pprof抓取火焰图，看看哪段逻辑消耗比较多
2. 如果压测发现是因为内存消耗过高，导致单机吞吐上不去，可以用pprof抓取内存火为火焰图，看看哪段逻辑在频繁地分配内存

### 下游组件瓶颈
1. 服务调用mysql 的IO时间过长，是不是返回的数据量过大
2. 请求存在慢查询，判断SQL以及索引是否合理
3. 表太大， 从库不够，还是mysql本身支持不了这么高的吞吐和这么严的延时要求

### 性能调优
1. 自身瓶颈，代码优化
2. 下游IO瓶颈，除了代码优化，比如分页请求，压缩
3. 下游组件优化后，需要从框架上去优化


